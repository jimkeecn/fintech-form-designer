@if(form){
<form [formGroup]="form">
    <p-accordion [activeIndex]="0">
        <p-accordionTab header="Basic Configuration">
            <div class="tw-flex tw-flex-col tw-gap-2">
                <div class="tw-flex tw-flex-col tw-gap-2 tw-mb-4">
                    <label [for]="'key_' + ffw_key">Key *</label>
                    <input
                        pInputText
                        [id]="'key_' + ffw_key"
                        aria-describedby="key"
                        formControlName="key"
                        data-testid="FieldConfigComponent.key"
                    />
                    <small [id]="'key_' + ffw_key + '_key_help'">
                        Change to your corresponding data key, please use smallcase, nospace and english only with
                        meaningful name e.g inv_name
                    </small>
                </div>
                <div class="tw-flex tw-flex-col tw-gap-2 tw-mb-4">
                    <p-dropdown
                        [options]="example_mapping"
                        placeholder="Select a mapping"
                        formControlName="map"
                        [showClear]="true"
                        [filter]="true"
                        class="tw-flex tw-flex-col"
                        aria-describedby="mapping"
                        [id]="'map_' + ffw_key"
                        data-testid="FieldConfigComponent.map"
                    >
                        <ng-template let-field pTemplate="item">
                            <div class="tw-flex tw-justify-between tw-items-center">
                                {{ field }}
                            </div>
                        </ng-template>
                    </p-dropdown>
                    <small [id]="'key_' + ffw_key + '_map_help'">
                        Mapping this field helps the system understand how to use it in key operations. If not mapped,
                        it will still be saved but only as extra info, not used in main processing.
                    </small>
                </div>
                @if(fieldType === 'select'){
                <div class="tw-flex tw-flex-col tw-gap-2">
                    <label [for]="'select_' + ffw_key">Data Source</label>
                    <p-dropdown
                        [options]="schemes"
                        optionLabel="name"
                        formControlName="selectedScheme"
                        data-testid="FieldConfigComponent.selectedScheme"
                        class="tw-flex tw-flex-col"
                        placeholder="Select a dropdown scheme"
                        [showClear]="true"
                    >
                        <ng-template pTemplate="selectedItem">
                            <div class="tw-flex tw-gap-3">
                                <span
                                    >{{ form.get('selectedScheme')?.value?.name ?? 'Please select a data source' }}
                                </span>
                                @for(prop of form.get('selectedScheme')?.value?.items.properties;track prop){
                                <span>[{{ prop.name }}]</span>
                                }
                            </div>
                        </ng-template>
                        <ng-template let-scheme pTemplate="scheme">
                            <div class="tw-flex tw-flex-col">
                                <div class="tw-text-lg">{{ scheme.name }}</div>
                                <div class="tw-text-sm tw-mt-2 tw-pl-2">Type: {{ scheme.type }}</div>
                                @for(prop of scheme.items.properties;track prop){
                                <div class="tw-text-sm tw-mt-2 tw-pl-4">[ {{ prop.name }} | {{ prop.type }}]</div>
                                }
                            </div>
                        </ng-template>
                    </p-dropdown>
                </div>
                }
                <div class="tw-flex tw-flex-col tw-gap-2">
                    <label [for]="'label_' + ffw_key">Label *</label>
                    <input
                        pInputText
                        [id]="'label_' + ffw_key"
                        aria-describedby="label"
                        formControlName="label"
                        data-testid="FieldConfigComponent.label"
                    />
                </div>
                <div class="tw-flex tw-flex-col tw-gap-2">
                    <label [for]="'placeholder_' + ffw_key">Placeholder</label>
                    <input
                        pInputText
                        [id]="'placeholder_' + ffw_key"
                        aria-describedby="placeholder"
                        formControlName="placeholder"
                        data-testid="FieldConfigComponent.placeholder"
                    />
                </div>
            </div>
        </p-accordionTab>
        @if(getActionable(fieldType)){
        <p-accordionTab header="Actions" class="ffb-accordion-no-padding">
            <p-tabView [scrollable]="true">
                @for(action of action_list;track action){
                <p-tabPanel [header]="action">
                    <ffw-select-config
                        [form]="returnHideForm(action)"
                        [action]="action"
                        [allFields]="allFields"
                        (add)="addAction($event)"
                        (remove)="removeAction($event)"
                    ></ffw-select-config>
                </p-tabPanel>

                }
            </p-tabView>
        </p-accordionTab>
        }
    </p-accordion>
</form>
}
